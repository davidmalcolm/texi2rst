

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Vague Linkage &mdash; gcc 6 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="gcc 6 documentation" href="index.html" />
    <link rel="up" title="Extensions to the C++ Language" href="extensions-to-the-c++-language.html" />
    <link rel="next" title="C++ Interface and Implementation Pragmas" href="c++-interface-and-implementation-pragmas.html" />
    <link rel="prev" title="Restricting Pointer Aliasing" href="restricting-pointer-aliasing.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="c++-interface-and-implementation-pragmas.html" title="C++ Interface and Implementation Pragmas"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="restricting-pointer-aliasing.html" title="Restricting Pointer Aliasing"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">gcc 6 documentation</a> &raquo;</li>
          <li><a href="gcc.html" >Introduction</a> &raquo;</li>
          <li><a href="extensions-to-the-c++-language.html" accesskey="U">Extensions to the C++ Language</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="restricting-pointer-aliasing.html"
                        title="previous chapter">Restricting Pointer Aliasing</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="c++-interface-and-implementation-pragmas.html"
                        title="next chapter">C++ Interface and Implementation Pragmas</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/vague-linkage.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="vague-linkage">
<span id="id1"></span><h1>Vague Linkage<a class="headerlink" href="#vague-linkage" title="Permalink to this headline">Â¶</a></h1>
<p id="index-0">There are several constructs in C++ that require space in the object
file but are not clearly tied to a single translation unit.  We say that
these constructs have &#8216;vague linkage&#8217;.  Typically such constructs are
emitted wherever they are needed, though sometimes we can be more
clever.</p>
<dl class="docutils">
<dt>Inline Functions</dt>
<dd><p class="first">Inline functions are typically defined in a header file which can be
included in many different compilations.  Hopefully they can usually be
inlined, but sometimes an out-of-line copy is necessary, if the address
of the function is taken or if inlining fails.  In general, we emit an
out-of-line copy in all translation units where one is needed.  As an
exception, we only emit inline virtual functions with the vtable, since
it always requires a copy.</p>
<p class="last">Local static variables and string constants used in an inline function
are also considered to have vague linkage, since they must be shared
between all inlined and out-of-line instances of the function.</p>
</dd>
</dl>
<p>VTables</p>
<blockquote>
<div><p id="index-1">C++ virtual functions are implemented in most compilers using a lookup
table, known as a vtable.  The vtable contains pointers to the virtual
functions provided by a class, and each object of the class contains a
pointer to its vtable (or vtables, in some multiple-inheritance
situations).  If the class declares any non-inline, non-pure virtual
functions, the first one is chosen as the &#8216;key method&#8217; for the class,
and the vtable is only emitted in the translation unit where the key
method is defined.</p>
<p>Note: If the chosen key method is later defined as inline, the
vtable is still emitted in every translation unit that defines it.
Make sure that any inline virtuals are declared inline in the class
body, even if they are not defined there.</p>
</div></blockquote>
<p><tt class="docutils literal"><span class="pre">type_info</span></tt> objects</p>
<blockquote>
<div><span class="target" id="index-2"></span><p id="index-3">C++ requires information about types to be written out in order to
implement dynamic_cast, typeid and exception handling.
For polymorphic classes (classes with virtual functions), the type_info
object is written out along with the vtable so that dynamic_cast
can determine the dynamic type of a class object at run time.  For all
other types, we write out the type_info object when it is used: when
applying typeid to an expression, throwing an object, or
referring to a type in a catch clause or exception specification.</p>
</div></blockquote>
<dl class="docutils">
<dt>Template Instantiations</dt>
<dd><p class="first">Most everything in this section also applies to template instantiations,
but there are other options as well.
See <a class="reference internal" href="where's-the-template?.html#template-instantiation"><em>Where&#8217;s the Template?</em></a>.</p>
<p class="last">When used with GNU ld version 2.8 or later on an ELF system such as</p>
</dd>
</dl>
<p>GNU/Linux or Solaris 2, or on Microsoft Windows, duplicate copies of
these constructs will be discarded at link time.  This is known as
COMDAT support.</p>
<p>On targets that don&#8217;t support COMDAT, but do support weak symbols, GCC
uses them.  This way one copy overrides all the others, but
the unused copies still take up space in the executable.</p>
<p>For targets that do not support either COMDAT or weak symbols,
most entities with vague linkage are emitted as local symbols to
avoid duplicate definition errors from the linker.  This does not happen
for local statics in inlines, however, as having multiple copies
almost certainly breaks things.</p>
<p>See <a class="reference internal" href="c++-interface-and-implementation-pragmas.html#c-interface"><em>Declarations and Definitions in One Header</em></a>, for
another way to control placement of these constructs.</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="c++-interface-and-implementation-pragmas.html" title="C++ Interface and Implementation Pragmas"
             >next</a> |</li>
        <li class="right" >
          <a href="restricting-pointer-aliasing.html" title="Restricting Pointer Aliasing"
             >previous</a> |</li>
        <li><a href="index.html">gcc 6 documentation</a> &raquo;</li>
          <li><a href="gcc.html" >Introduction</a> &raquo;</li>
          <li><a href="extensions-to-the-c++-language.html" >Extensions to the C++ Language</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, gcc peeps.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>