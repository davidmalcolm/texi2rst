

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Statements and Declarations in Expressions &mdash; gcc 6 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="gcc 6 documentation" href="index.html" />
    <link rel="up" title="Extensions to the C Language Family" href="extensions-to-the-c-language-family.html" />
    <link rel="next" title="Locally Declared Labels" href="locally-declared-labels.html" />
    <link rel="prev" title="x86-Specific Memory Model Extensions for Transactional Memory" href="x86-specific-memory-model-extensions-for-transactional-memory.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="locally-declared-labels.html" title="Locally Declared Labels"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="x86-specific-memory-model-extensions-for-transactional-memory.html" title="x86-Specific Memory Model Extensions for Transactional Memory"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">gcc 6 documentation</a> &raquo;</li>
          <li><a href="gcc.html" >Introduction</a> &raquo;</li>
          <li><a href="extensions-to-the-c-language-family.html" accesskey="U">Extensions to the C Language Family</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="x86-specific-memory-model-extensions-for-transactional-memory.html"
                        title="previous chapter">x86-Specific Memory Model Extensions for Transactional Memory</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="locally-declared-labels.html"
                        title="next chapter">Locally Declared Labels</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/statements-and-declarations-in-expressions.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="statements-and-declarations-in-expressions">
<span id="statement-exprs"></span><h1>Statements and Declarations in Expressions<a class="headerlink" href="#statements-and-declarations-in-expressions" title="Permalink to this headline">Â¶</a></h1>
<span class="target" id="index-0"></span><span class="target" id="index-1"></span><span class="target" id="index-2"></span><span class="target" id="index-3"></span><p>A compound statement enclosed in parentheses may appear as an expression
in GNU C.  This allows you to use loops, switches, and local variables
within an expression.</p>
<p>Recall that a compound statement is a sequence of statements surrounded
by braces; in this construct, parentheses go around the braces.  For
example:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="p">({</span> <span class="kt">int</span> <span class="n">y</span> <span class="o">=</span> <span class="n">foo</span> <span class="p">();</span> <span class="kt">int</span> <span class="n">z</span><span class="p">;</span>
   <span class="k">if</span> <span class="p">(</span><span class="n">y</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="n">z</span> <span class="o">=</span> <span class="n">y</span><span class="p">;</span>
   <span class="k">else</span> <span class="n">z</span> <span class="o">=</span> <span class="o">-</span> <span class="n">y</span><span class="p">;</span>
   <span class="n">z</span><span class="p">;</span> <span class="p">})</span>
</pre></div>
</div>
<p>is a valid (though slightly more complex than necessary) expression
for the absolute value of <tt class="docutils literal"><span class="pre">foo</span> <span class="pre">()</span></tt>.</p>
<p>The last thing in the compound statement should be an expression
followed by a semicolon; the value of this subexpression serves as the
value of the entire construct.  (If you use some other kind of statement
last within the braces, the construct has type <tt class="docutils literal"><span class="pre">void</span></tt>, and thus
effectively no value.)</p>
<p>This feature is especially useful in making macro definitions &#8216;safe&#8217; (so
that they evaluate each operand exactly once).  For example, the
&#8216;maximum&#8217; function is commonly defined as a macro in standard C as
follows:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#define max(a,b) ((a) &gt; (b) ? (a) : (b))</span>
</pre></div>
</div>
<p id="index-4">But this definition computes either <tt class="docutils literal"><span class="pre">a</span></tt> or <tt class="docutils literal"><span class="pre">b</span></tt> twice, with bad
results if the operand has side effects.  In GNU C, if you know the
type of the operands (here taken as <tt class="docutils literal"><span class="pre">int</span></tt>), you can define
the macro safely as follows:</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#define maxint(a,b) \</span>
<span class="cp">  ({int _a = (a), _b = (b); _a &gt; _b ? _a : _b; })</span>
</pre></div>
</div>
<p>Embedded statements are not allowed in constant expressions, such as
the value of an enumeration constant, the width of a bit-field, or
the initial value of a static variable.</p>
<p>If you don&#8217;t know the type of the operand, you can still do this, but you
must use <tt class="docutils literal"><span class="pre">typeof</span></tt> or <tt class="docutils literal"><span class="pre">__auto_type</span></tt> (Typeof).</p>
<p>In G++, the result value of a statement expression undergoes array and
function pointer decay, and is returned by value to the enclosing
expression.  For instance, if <tt class="docutils literal"><span class="pre">A</span></tt> is a class, then</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">A</span> <span class="n">a</span><span class="p">;</span>

<span class="p">({</span><span class="n">a</span><span class="p">;}).</span><span class="n">Foo</span> <span class="p">()</span>
</pre></div>
</div>
<p>constructs a temporary <tt class="docutils literal"><span class="pre">A</span></tt> object to hold the result of the
statement expression, and that is used to invoke <tt class="docutils literal"><span class="pre">Foo</span></tt>.
Therefore the <tt class="docutils literal"><span class="pre">this</span></tt> pointer observed by <tt class="docutils literal"><span class="pre">Foo</span></tt> is not the
address of <tt class="docutils literal"><span class="pre">a</span></tt>.</p>
<p>In a statement expression, any temporaries created within a statement
are destroyed at that statement&#8217;s end.  This makes statement
expressions inside macros slightly different from function calls.  In
the latter case temporaries introduced during argument evaluation are
destroyed at the end of the statement that includes the function
call.  In the statement expression case they are destroyed during
the statement expression.  For instance,</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#define macro(a)  ({__typeof__(a) b = (a); b + 3; })</span>
<span class="k">template</span><span class="o">&lt;</span><span class="k">typename</span> <span class="n">T</span><span class="o">&gt;</span> <span class="n">T</span> <span class="n">function</span><span class="p">(</span><span class="n">T</span> <span class="n">a</span><span class="p">)</span> <span class="p">{</span> <span class="n">T</span> <span class="n">b</span> <span class="o">=</span> <span class="n">a</span><span class="p">;</span> <span class="k">return</span> <span class="n">b</span> <span class="o">+</span> <span class="mi">3</span><span class="p">;</span> <span class="p">}</span>

<span class="kt">void</span> <span class="n">foo</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="n">macro</span> <span class="p">(</span><span class="n">X</span> <span class="p">());</span>
  <span class="n">function</span> <span class="p">(</span><span class="n">X</span> <span class="p">());</span>
<span class="p">}</span>
</pre></div>
</div>
<p>has different places where temporaries are destroyed.  For the
<tt class="docutils literal"><span class="pre">macro</span></tt> case, the temporary <tt class="docutils literal"><span class="pre">X</span></tt> is destroyed just after
the initialization of <tt class="docutils literal"><span class="pre">b</span></tt>.  In the <tt class="docutils literal"><span class="pre">function</span></tt> case that
temporary is destroyed when the function returns.</p>
<p>These considerations mean that it is probably a bad idea to use
statement expressions of this form in header files that are designed to
work with C++.  (Note that some versions of the GNU C Library contained
header files using statement expressions that lead to precisely this
bug.)</p>
<p>Jumping into a statement expression with <tt class="docutils literal"><span class="pre">goto</span></tt> or using a
<tt class="docutils literal"><span class="pre">switch</span></tt> statement outside the statement expression with a
<tt class="docutils literal"><span class="pre">case</span></tt> or <tt class="docutils literal"><span class="pre">default</span></tt> label inside the statement expression is
not permitted.  Jumping into a statement expression with a computed
<tt class="docutils literal"><span class="pre">goto</span></tt> (Labels as Values) has undefined behavior.
Jumping out of a statement expression is permitted, but if the
statement expression is part of a larger expression then it is
unspecified which other subexpressions of that expression have been
evaluated except where the language definition requires certain
subexpressions to be evaluated before or after the statement
expression.  In any case, as with a function call, the evaluation of a
statement expression is not interleaved with the evaluation of other
parts of the containing expression.  For example,</p>
<div class="highlight-c++"><div class="highlight"><pre><span class="n">foo</span> <span class="p">(),</span> <span class="p">(({</span> <span class="n">bar1</span> <span class="p">();</span> <span class="k">goto</span> <span class="n">a</span><span class="p">;</span> <span class="mi">0</span><span class="p">;</span> <span class="p">})</span> <span class="o">+</span> <span class="n">bar2</span> <span class="p">()),</span> <span class="n">baz</span><span class="p">();</span>
</pre></div>
</div>
<p>calls <tt class="docutils literal"><span class="pre">foo</span></tt> and <tt class="docutils literal"><span class="pre">bar1</span></tt> and does not call <tt class="docutils literal"><span class="pre">baz</span></tt> but
may or may not call <tt class="docutils literal"><span class="pre">bar2</span></tt>.  If <tt class="docutils literal"><span class="pre">bar2</span></tt> is called, it is
called after <tt class="docutils literal"><span class="pre">foo</span></tt> and before <tt class="docutils literal"><span class="pre">bar1</span></tt>.</p>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="locally-declared-labels.html" title="Locally Declared Labels"
             >next</a> |</li>
        <li class="right" >
          <a href="x86-specific-memory-model-extensions-for-transactional-memory.html" title="x86-Specific Memory Model Extensions for Transactional Memory"
             >previous</a> |</li>
        <li><a href="index.html">gcc 6 documentation</a> &raquo;</li>
          <li><a href="gcc.html" >Introduction</a> &raquo;</li>
          <li><a href="extensions-to-the-c-language-family.html" >Extensions to the C Language Family</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, gcc peeps.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>