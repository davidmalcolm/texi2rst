

<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>x86-Specific Memory Model Extensions for Transactional Memory &mdash; gcc 6 documentation</title>
    
    <link rel="stylesheet" href="_static/sphinxdoc.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '',
        VERSION:     '6',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <link rel="top" title="gcc 6 documentation" href="index.html" />
    <link rel="up" title="Extensions to the C Language Family" href="extensions-to-the-c-language-family.html" />
    <link rel="next" title="Object Size Checking Built-in Functions" href="object-size-checking-built-in-functions.html" />
    <link rel="prev" title="Built-in Functions to Perform Arithmetic with Overflow Checking" href="built-in-functions-to-perform-arithmetic-with-overflow-checking.html" /> 
  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="object-size-checking-built-in-functions.html" title="Object Size Checking Built-in Functions"
             accesskey="N">next</a> |</li>
        <li class="right" >
          <a href="built-in-functions-to-perform-arithmetic-with-overflow-checking.html" title="Built-in Functions to Perform Arithmetic with Overflow Checking"
             accesskey="P">previous</a> |</li>
        <li><a href="index.html">gcc 6 documentation</a> &raquo;</li>
          <li><a href="gcc.html" >Introduction</a> &raquo;</li>
          <li><a href="extensions-to-the-c-language-family.html" accesskey="U">Extensions to the C Language Family</a> &raquo;</li> 
      </ul>
    </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
  <h4>Previous topic</h4>
  <p class="topless"><a href="built-in-functions-to-perform-arithmetic-with-overflow-checking.html"
                        title="previous chapter">Built-in Functions to Perform Arithmetic with Overflow Checking</a></p>
  <h4>Next topic</h4>
  <p class="topless"><a href="object-size-checking-built-in-functions.html"
                        title="next chapter">Object Size Checking Built-in Functions</a></p>
  <h3>This Page</h3>
  <ul class="this-page-menu">
    <li><a href="_sources/x86-specific-memory-model-extensions-for-transactional-memory.txt"
           rel="nofollow">Show Source</a></li>
  </ul>
<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <div class="section" id="x86-specific-memory-model-extensions-for-transactional-memory">
<span id="id1"></span><h1>x86-Specific Memory Model Extensions for Transactional Memory<a class="headerlink" href="#x86-specific-memory-model-extensions-for-transactional-memory" title="Permalink to this headline">Â¶</a></h1>
<p>The x86 architecture supports additional memory ordering flags
to mark lock critical sections for hardware lock elision.
These must be specified in addition to an existing memory model to
atomic intrinsics.</p>
<dl class="docutils">
<dt>__ATOMIC_HLE_ACQUIRE</dt>
<dd>Start lock elision on a lock variable.
Memory model must be <tt class="docutils literal"><span class="pre">__ATOMIC_ACQUIRE</span></tt> or stronger.</dd>
<dt>__ATOMIC_HLE_RELEASE</dt>
<dd><p class="first">End lock elision on a lock variable.
Memory model must be <tt class="docutils literal"><span class="pre">__ATOMIC_RELEASE</span></tt> or stronger.</p>
<p class="last">When a lock acquire fails it is required for good performance to abort</p>
</dd>
</dl>
<p>the transaction quickly. This can be done with a <tt class="docutils literal"><span class="pre">_mm_pause</span></tt></p>
<div class="highlight-c++"><div class="highlight"><pre><span class="cp">#include &lt;immintrin.h&gt; </span><span class="c1">// For _mm_pause</span>

<span class="kt">int</span> <span class="n">lockvar</span><span class="p">;</span>

<span class="cm">/* Acquire lock with lock elision */</span>
<span class="k">while</span> <span class="p">(</span><span class="n">__atomic_exchange_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lockvar</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">__ATOMIC_ACQUIRE</span><span class="o">|</span><span class="n">__ATOMIC_HLE_ACQUIRE</span><span class="p">))</span>
    <span class="n">_mm_pause</span><span class="p">();</span> <span class="cm">/* Abort failed transaction */</span>
<span class="p">...</span>
<span class="cm">/* Free lock with lock elision */</span>
<span class="n">__atomic_store_n</span><span class="p">(</span><span class="o">&amp;</span><span class="n">lockvar</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="n">__ATOMIC_RELEASE</span><span class="o">|</span><span class="n">__ATOMIC_HLE_RELEASE</span><span class="p">);</span>
</pre></div>
</div>
</div>


          </div>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="genindex.html" title="General Index"
             >index</a></li>
        <li class="right" >
          <a href="object-size-checking-built-in-functions.html" title="Object Size Checking Built-in Functions"
             >next</a> |</li>
        <li class="right" >
          <a href="built-in-functions-to-perform-arithmetic-with-overflow-checking.html" title="Built-in Functions to Perform Arithmetic with Overflow Checking"
             >previous</a> |</li>
        <li><a href="index.html">gcc 6 documentation</a> &raquo;</li>
          <li><a href="gcc.html" >Introduction</a> &raquo;</li>
          <li><a href="extensions-to-the-c-language-family.html" >Extensions to the C Language Family</a> &raquo;</li> 
      </ul>
    </div>
    <div class="footer">
        &copy; Copyright 2015, gcc peeps.
      Created using <a href="http://sphinx.pocoo.org/">Sphinx</a> 1.1.3.
    </div>
  </body>
</html>